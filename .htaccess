<<<<<<< HEAD
# Active le moteur de réécriture d'URL
RewriteEngine On

# Redirige toutes les requêtes qui ne sont pas des fichiers ou des dossiers existants
# vers le point d'entrée public/index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ public/index.php [QSA,L]

# Améliore la sécurité
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>
Options -Indexes

# Protection contre les attaques XSS
<IfModule mod_headers.c>
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://unpkg.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self'"
</IfModule>
=======
# www/.htaccess - Configuration OVH

# ========================================
# SÉCURITÉ: Headers HTTP
# ========================================

<IfModule mod_headers.c>
    # Empêcher l'embedding (clickjacking)
    Header always set X-Frame-Options "DENY"
    
    # Empêcher le sniffing MIME
    Header always set X-Content-Type-Options "nosniff"
    
    # Protection XSS navigateur
    Header always set X-XSS-Protection "1; mode=block"
    
    # HSTS - Forcer HTTPS (activé après avoir testé!)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://unpkg.com https://js.stripe.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://unpkg.com; img-src 'self' data: https: blob:; font-src 'self' data: https://cdnjs.cloudflare.com; connect-src 'self' https://api.stripe.com; frame-src https://js.stripe.com; object-src 'none'; base-uri 'self'; form-action 'self'"
    
    # Permissions Policy
    Header always set Permissions-Policy "geolocation=(self), camera=(), microphone=(), payment=(self)"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Retirer les headers qui révèlent des infos
    Header unset X-Powered-By
    Header unset Server
</IfModule>

# ========================================
# HTTPS: Redirection forcée
# ========================================

RewriteEngine On

# Forcer HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Forcer www (ou non-www, à choisir)
# Option 1: Forcer www
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Option 2: Forcer non-www (décommenter si préféré)
# RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
# RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [L,R=301]

# ========================================
# ROUTAGE: Tout vers index.php
# ========================================

# Empêcher l'accès direct aux fichiers PHP (sauf index.php)
RewriteCond %{THE_REQUEST} \.php
RewriteCond %{REQUEST_URI} !^/index\.php
RewriteRule ^(.*)$ - [F,L]

# Router tout vers index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# ========================================
# PROTECTION: Fichiers sensibles
# ========================================

# Bloquer .env
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

# Bloquer fichiers de config
<FilesMatch "\.(ini|log|conf|sql|bak)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Bloquer dossiers sensibles
RedirectMatch 403 ^/(config|src|vendor|install)/

# ========================================
# UPLOAD: Sécurité fichiers
# ========================================

# Interdire l'exécution de PHP dans uploads
<Directory "*/uploads">
    php_flag engine off
    RemoveHandler .php .phtml .php3 .php4 .php5
    RemoveType .php .phtml .php3 .php4 .php5
    
    <FilesMatch "\.php$">
        Order allow,deny
        Deny from all
    </FilesMatch>
</Directory>

# ========================================
# PERFORMANCE: Compression
# ========================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ========================================
# CACHE: Headers navigateur
# ========================================

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>

# ========================================
# PHP: Configuration OVH
# ========================================

php_value upload_max_filesize 5M
php_value post_max_size 6M
php_value memory_limit 128M
php_value max_execution_time 30
php_value max_input_time 60

# Cacher la version PHP
php_flag expose_php Off

# Sessions sécurisées
php_value session.cookie_httponly 1
php_value session.cookie_secure 1
php_value session.use_only_cookies 1
php_value session.cookie_samesite Strict
>>>>>>> 3d7d07f (Initial commit avec dossier uploads et config Env.php)
